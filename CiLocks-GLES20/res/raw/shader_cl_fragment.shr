#version 100

precision mediump float;

uniform sampler2D u_ColorMap;
uniform sampler2D u_NormalMap;

varying vec2 v_UV;
varying vec3 v_Light;
varying float v_Distance;

void main()
{
	vec3 normal = normalize(texture2D(u_NormalMap, v_UV).rgb * 2.0 - 1.0);
	
	float diffuse = dot(normal, v_Light);
	diffuse = clamp(diffuse * (1.0 / (1.0 + (0.25 * v_Distance * v_Distance))), 0.1, 1.0);
	
	gl_FragColor = texture2D(u_ColorMap, v_UV) * diffuse;
}